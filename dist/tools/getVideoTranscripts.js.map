{"version":3,"file":"getVideoTranscripts.js","names":[],"sources":["../../src/tools/getVideoTranscripts.ts"],"sourcesContent":["import { config } from \"../config.ts\";\r\nimport { makeVbrickRevApiRequest, formatResponse } from \"../vbrickUtilities.ts\";\r\nimport { z } from \"zod\";\r\n\r\nexport const getVideoTranscriptsTool = {\r\n  name: \"vbrick_get_video_transcripts\",\r\n  description: \"Get transcripts for a specific video within Vbrick Rev. \" + \r\n    \"The transcript is returned in SRT format with timestamps. \" + \r\n    \"Return just the text to the user unless more information is requested. \",\r\n  inputSchema: {\r\n    videoId: z.string().describe(\"ID of the video to retrieve\")\r\n  },\r\n  async handler({ videoId }: { videoId: string }) {\r\n    const videoUrl = `${config.vbrickRevTenantUrl}/api/v2/videos/${videoId}/transcription-files/en`;\r\n    const videoStream = await makeVbrickRevApiRequest<any>(videoUrl);\r\n\r\n    if (!videoStream || typeof videoStream.getReader !== \"function\") {\r\n      return formatResponse(\"Failed to retrieve video transcripts\", \"text\");\r\n    }\r\n\r\n    // Read the stream to string\r\n    let transcriptText = \"\";\r\n    const reader = videoStream.getReader();\r\n    const decoder = new TextDecoder();\r\n    while (true) {\r\n      const { done, value } = await reader.read();\r\n      if (done) break;\r\n      transcriptText += decoder.decode(value, { stream: true });\r\n    }\r\n\r\n    if (!transcriptText) {\r\n      return formatResponse(\"Transcript is empty\", \"text\");\r\n    }\r\n\r\n    return formatResponse({ transcript: transcriptText }, \"json\");\r\n  }\r\n};\r\n"],"mappings":";;;;AAIA,MAAa,0BAA0B;CACrC,MAAM;CACN,aAAa;CAGb,aAAa,EACX,SAAS,EAAE,QAAQ,CAAC,SAAS,8BAA8B,EAC5D;CACD,MAAM,QAAQ,EAAE,WAAgC;EAE9C,MAAM,cAAc,MAAM,wBADT,GAAG,OAAO,mBAAmB,iBAAiB,QAAQ,yBACP;AAEhE,MAAI,CAAC,eAAe,OAAO,YAAY,cAAc,WACnD,QAAO,eAAe,wCAAwC,OAAO;EAIvE,IAAI,iBAAiB;EACrB,MAAM,SAAS,YAAY,WAAW;EACtC,MAAM,UAAU,IAAI,aAAa;AACjC,SAAO,MAAM;GACX,MAAM,EAAE,MAAM,UAAU,MAAM,OAAO,MAAM;AAC3C,OAAI,KAAM;AACV,qBAAkB,QAAQ,OAAO,OAAO,EAAE,QAAQ,MAAM,CAAC;;AAG3D,MAAI,CAAC,eACH,QAAO,eAAe,uBAAuB,OAAO;AAGtD,SAAO,eAAe,EAAE,YAAY,gBAAgB,EAAE,OAAO;;CAEhE"}